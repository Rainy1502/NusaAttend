<!DOCTYPE html>
<html lang="id">
  {{>head}}
  <body>
    {{>header}}
    
    <main class="container py-5">
      <h1 class="mb-4">
        <i class="fas fa-list"></i> Manajemen Pengajuan
      </h1>

      <!-- Filter Section -->
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-3">
              <select class="form-select" id="filterStatus">
                <option value="">Semua Status</option>
                <option value="menunggu_persetujuan">Menunggu Persetujuan</option>
                <option value="disetujui">Disetujui</option>
                <option value="ditolak">Ditolak</option>
              </select>
            </div>
            <div class="col-md-3">
              <select class="form-select" id="filterJenis">
                <option value="">Semua Jenis</option>
                <option value="cuti">Cuti</option>
                <option value="izin_tidak_masuk">Izin Tidak Masuk</option>
                <option value="izin_sakit">Izin Sakit</option>
                <option value="wfh">Work From Home</option>
              </select>
            </div>
            <div class="col-md-3">
              <input type="date" class="form-control" id="filterTanggal" placeholder="Filter tanggal">
            </div>
            <div class="col-md-3">
              <button class="btn btn-primary w-100" onclick="applyFilters()">
                <i class="fas fa-filter"></i> Filter
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Table Section -->
      <div class="card shadow">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">
            <i class="fas fa-table"></i> Daftar Pengajuan
          </h5>
        </div>
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead class="table-light">
              <tr>
                <th>No</th>
                <th>Nama Karyawan</th>
                <th>Jenis Pengajuan</th>
                <th>Tanggal</th>
                <th>Status</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody>
              {{#if pengajuan}}
                {{#each pengajuan}}
                  <tr>
                    <td>{{@index}}</td>
                    <td>{{this.karyawan_nama}}</td>
                    <td>
                      {{#if (eq this.jenis_pengajuan "cuti")}}
                        <span class="badge bg-info">Cuti Tahunan</span>
                      {{else if (eq this.jenis_pengajuan "izin_tidak_masuk")}}
                        <span class="badge bg-secondary">Izin Tidak Masuk</span>
                      {{else if (eq this.jenis_pengajuan "izin_sakit")}}
                        <span class="badge bg-warning">Izin Sakit</span>
                      {{else}}
                        <span class="badge bg-primary">WFH</span>
                      {{/if}}
                    </td>
                    <td>
                      {{format_date this.tanggal_mulai}} - {{format_date this.tanggal_selesai}}
                    </td>
                    <td>
                      {{#if (eq this.status "menunggu_persetujuan")}}
                        <span class="badge bg-warning">
                          <i class="fas fa-hourglass-half"></i> Menunggu
                        </span>
                      {{else if (eq this.status "disetujui")}}
                        <span class="badge bg-success">
                          <i class="fas fa-check"></i> Disetujui
                        </span>
                      {{else}}
                        <span class="badge bg-danger">
                          <i class="fas fa-times"></i> Ditolak
                        </span>
                      {{/if}}
                    </td>
                    <td>
                      <a href="/admin/pengajuan/{{this._id}}" class="btn btn-sm btn-info">
                        <i class="fas fa-eye"></i> Lihat
                      </a>
                    </td>
                  </tr>
                {{/each}}
              {{else}}
                <tr>
                  <td colspan="6" class="text-center text-muted py-4">
                    Tidak ada pengajuan
                  </td>
                </tr>
              {{/if}}
            </tbody>
          </table>
        </div>
      </div>
    </main>

    {{>footer}}

    <script>
      function applyFilters() {
        const status = document.getElementById('filterStatus').value;
        const jenis = document.getElementById('filterJenis').value;
        const tanggal = document.getElementById('filterTanggal').value;

        let url = '/api/admin/pengajuan?';
        if (status) url += 'status=' + status + '&';
        if (jenis) url += 'jenis=' + jenis + '&';
        if (tanggal) url += 'tanggal=' + tanggal;

        fetch(url)
          .then(res => res.json())
          .then(data => {
            console.log(data);
            // Reload page atau update tabel
            location.reload();
          });
      }
    </script>
  </body>
</html>
