<!DOCTYPE html>
<html lang="id">
  {{>head}}
  <body>
    {{>header}}
    
    <main class="container py-5">
      <h1 class="mb-4">
        <i class="fas fa-file-alt"></i> Buat Surat Izin
      </h1>

      {{#if error}}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          <i class="fas fa-exclamation-circle"></i> {{error}}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {{/if}}

      <div class="row">
        <div class="col-lg-8">
          <div class="card shadow">
            <div class="card-body">
              <form id="pengajuanForm" method="POST" action="/api/pengajuan">
                
                <div class="mb-3">
                  <label for="jenis_pengajuan" class="form-label">
                    <i class="fas fa-list"></i> Jenis Pengajuan <span class="text-danger">*</span>
                  </label>
                  <select class="form-select" id="jenis_pengajuan" name="jenis_pengajuan" required>
                    <option value="">Pilih jenis pengajuan...</option>
                    <option value="cuti">Cuti Tahunan</option>
                    <option value="izin_tidak_masuk">Izin Tidak Masuk Kerja</option>
                    <option value="izin_sakit">Izin Sakit</option>
                    <option value="wfh">Work From Home (WFH)</option>
                  </select>
                </div>

                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="tanggal_mulai" class="form-label">
                      <i class="fas fa-calendar-alt"></i> Tanggal Mulai <span class="text-danger">*</span>
                    </label>
                    <input 
                      type="date" 
                      class="form-control" 
                      id="tanggal_mulai" 
                      name="tanggal_mulai"
                      required
                    >
                  </div>

                  <div class="col-md-6 mb-3">
                    <label for="tanggal_selesai" class="form-label">
                      <i class="fas fa-calendar-alt"></i> Tanggal Selesai <span class="text-danger">*</span>
                    </label>
                    <input 
                      type="date" 
                      class="form-control" 
                      id="tanggal_selesai" 
                      name="tanggal_selesai"
                      required
                    >
                  </div>
                </div>

                <div class="mb-3">
                  <label for="alasan" class="form-label">
                    <i class="fas fa-comment"></i> Alasan <span class="text-danger">*</span>
                  </label>
                  <textarea 
                    class="form-control" 
                    id="alasan" 
                    name="alasan" 
                    rows="4" 
                    placeholder="Jelaskan alasan pengajuan Anda..."
                    required
                  ></textarea>
                  <small class="form-text text-muted">Minimum 10 karakter</small>
                </div>

                <div class="alert alert-info" id="cutiAlert" style="display: none;">
                  <i class="fas fa-info-circle"></i> 
                  <strong>Informasi Cuti:</strong>
                  <p class="mb-0">Sisa cuti Anda: <strong id="sisaCuti">{{user.sisa_cuti}}</strong> hari</p>
                  <p class="mb-0">Akan digunakan: <strong id="gunakanCuti">0</strong> hari</p>
                </div>

                <div class="d-flex gap-2">
                  <button type="submit" class="btn btn-primary">
                    <i class="fas fa-paper-plane"></i> Preview Surat
                  </button>
                  <a href="/pengajuan" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Kembali
                  </a>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Info Card -->
        <div class="col-lg-4">
          <div class="card shadow-sm bg-light">
            <div class="card-body">
              <h5 class="card-title">
                <i class="fas fa-lightbulb"></i> Bantuan
              </h5>
              <p class="card-text text-muted">
                <strong>Cuti Tahunan:</strong> Cuti yang diberikan setiap tahun (max 12 hari)
              </p>
              <p class="card-text text-muted">
                <strong>Izin Tidak Masuk:</strong> Izin tanpa keterangan khusus
              </p>
              <p class="card-text text-muted">
                <strong>Izin Sakit:</strong> Izin karena sakit (perlu surat dokter)
              </p>
              <p class="card-text text-muted">
                <strong>WFH:</strong> Bekerja dari rumah dengan alasan tertentu
              </p>
              <hr>
              <p class="card-text text-muted small">
                Setelah mengisi formulir, Anda akan diminta untuk memberikan tanda tangan digital sebelum pengajuan dikirim.
              </p>
            </div>
          </div>
        </div>
      </div>
    </main>

    {{>footer}}

    <script>
      const jenisPengajuanSelect = document.getElementById('jenis_pengajuan');
      const cutiAlert = document.getElementById('cutiAlert');
      const tanggalMulai = document.getElementById('tanggal_mulai');
      const tanggalSelesai = document.getElementById('tanggal_selesai');
      const gunakanCuti = document.getElementById('gunakanCuti');

      // Show/hide cuti info
      jenisPengajuanSelect.addEventListener('change', function() {
        if (this.value === 'cuti') {
          cutiAlert.style.display = 'block';
          updateCutiInfo();
        } else {
          cutiAlert.style.display = 'none';
        }
      });

      // Update jumlah cuti yang akan digunakan
      tanggalMulai.addEventListener('change', updateCutiInfo);
      tanggalSelesai.addEventListener('change', updateCutiInfo);

      function updateCutiInfo() {
        if (!tanggalMulai.value || !tanggalSelesai.value) return;

        const mulai = new Date(tanggalMulai.value);
        const selesai = new Date(tanggalSelesai.value);
        const jumlah = Math.ceil((selesai - mulai) / (1000 * 60 * 60 * 24)) + 1;

        gunakanCuti.textContent = jumlah;
      }

      // Form validation
      document.getElementById('pengajuanForm').addEventListener('submit', function(e) {
        const jenis = jenisPengajuanSelect.value;
        const alasan = document.getElementById('alasan').value;

        if (!jenis) {
          e.preventDefault();
          alert('Silakan pilih jenis pengajuan');
          return false;
        }

        if (alasan.length < 10) {
          e.preventDefault();
          alert('Alasan minimal 10 karakter');
          return false;
        }
      });
    </script>
  </body>
</html>
