<!DOCTYPE html>
<html lang="id">
  {{>head}}
  <body>
    {{>header}}
    
    <main class="container py-5">
      <div class="row">
        <div class="col-lg-8 offset-lg-2">
          <h1 class="mb-4 text-center">
            <i class="fas fa-clock"></i> Absensi Harian
          </h1>

          {{#if error}}
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
              <i class="fas fa-exclamation-circle"></i> {{error}}
              <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
          {{/if}}

          {{#if success}}
            <div class="alert alert-success alert-dismissible fade show" role="alert">
              <i class="fas fa-check-circle"></i> {{success}}
              <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
          {{/if}}

          <!-- Absensi Hari Ini -->
          <div class="card shadow mb-4">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0">
                <i class="fas fa-calendar-today"></i> Absensi Hari Ini
              </h5>
            </div>
            <div class="card-body">
              <div class="row text-center">
                <div class="col-md-6 mb-3">
                  <h6 class="text-muted mb-3">Jam Masuk</h6>
                  <div id="jamMasuk" class="display-6 mb-3">
                    {{#if absensi_hari_ini.jam_masuk}}
                      {{absensi_hari_ini.jam_masuk}}
                    {{else}}
                      --:--:--
                    {{/if}}
                  </div>
                  {{#if absensi_hari_ini.jam_masuk}}
                    <span class="badge bg-success">
                      <i class="fas fa-check"></i> Sudah Absen Masuk
                    </span>
                  {{else}}
                    <form method="POST" action="/api/absensi/masuk" style="display: inline;">
                      <button type="submit" class="btn btn-success btn-lg">
                        <i class="fas fa-sign-in-alt"></i> Absen Masuk
                      </button>
                    </form>
                  {{/if}}
                </div>

                <div class="col-md-6 mb-3">
                  <h6 class="text-muted mb-3">Jam Pulang</h6>
                  <div id="jamPulang" class="display-6 mb-3">
                    {{#if absensi_hari_ini.jam_pulang}}
                      {{absensi_hari_ini.jam_pulang}}
                    {{else}}
                      --:--:--
                    {{/if}}
                  </div>
                  {{#if absensi_hari_ini.jam_pulang}}
                    <span class="badge bg-success">
                      <i class="fas fa-check"></i> Sudah Absen Pulang
                    </span>
                  {{else if absensi_hari_ini.jam_masuk}}
                    <form method="POST" action="/api/absensi/pulang" style="display: inline;">
                      <button type="submit" class="btn btn-warning btn-lg">
                        <i class="fas fa-sign-out-alt"></i> Absen Pulang
                      </button>
                    </form>
                  {{else}}
                    <button class="btn btn-secondary btn-lg" disabled>
                      <i class="fas fa-sign-out-alt"></i> Absen Pulang
                    </button>
                  {{/if}}
                </div>
              </div>
            </div>
          </div>

          <!-- Riwayat Absensi -->
          <div class="card shadow">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0">
                <i class="fas fa-history"></i> Riwayat Absensi (30 hari terakhir)
              </h5>
            </div>
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead class="table-light">
                  <tr>
                    <th>Tanggal</th>
                    <th>Jam Masuk</th>
                    <th>Jam Pulang</th>
                    <th>Status</th>
                    <th>Keterangan</th>
                  </tr>
                </thead>
                <tbody>
                  {{#if absensi_list}}
                    {{#each absensi_list}}
                      <tr>
                        <td>{{format_date this.tanggal}}</td>
                        <td>{{this.jam_masuk}}</td>
                        <td>{{this.jam_pulang}}</td>
                        <td>
                          {{#if (eq this.status "hadir")}}
                            <span class="badge bg-success">Hadir</span>
                          {{else if (eq this.status "izin")}}
                            <span class="badge bg-info">Izin</span>
                          {{else if (eq this.status "cuti")}}
                            <span class="badge bg-warning">Cuti</span>
                          {{else if (eq this.status "sakit")}}
                            <span class="badge bg-warning">Sakit</span>
                          {{else}}
                            <span class="badge bg-danger">Tidak Hadir</span>
                          {{/if}}
                        </td>
                        <td>{{this.keterangan}}</td>
                      </tr>
                    {{/each}}
                  {{else}}
                    <tr>
                      <td colspan="5" class="text-center text-muted py-4">
                        Belum ada riwayat absensi
                      </td>
                    </tr>
                  {{/if}}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </main>

    {{>footer}}

    <script>
      // Update jam setiap detik
      function updateWaktu() {
        const now = new Date();
        const jamString = now.toLocaleTimeString('id-ID');
        
        {{#if absensi_hari_ini.jam_masuk}}
          // Hanya tampilkan jam pulang saat ini jika belum ada
          if (!{{#if absensi_hari_ini.jam_pulang}}true{{else}}false{{/if}}) {
            document.getElementById('jamPulang').textContent = jamString;
          }
        {{else}}
          document.getElementById('jamMasuk').textContent = jamString;
        {{/if}}
      }

      // Update setiap detik
      setInterval(updateWaktu, 1000);
    </script>
  </body>
</html>
